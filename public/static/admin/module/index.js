layui.define(["admin"],function(a){var e=layui.jquery,t=layui.element,i=layui.cache.bins,l=layui.admin,n=l.router,r=".layui-layout-admin>.layui-header",s=".layui-layout-admin>.layui-side>.layui-side-scroll",d=".layui-layout-admin>.layui-body",o=d+">.layui-tab",u=d+">.layui-body-header",c="admin-pagetabs",h=!1,y={mTabList:[],regRouter:function(a,t){e.each(a,function(a,i){t&&(i=t(i)),i.url&&0===i.url.indexOf("#")&&n.reg(i.url,function(a){y.changeView(e.extend(a,{name:i.name,iframe:i.iframe}))}),i.subMenus&&y.regRouter(i.subMenus,t)})},changeView:function(a){var r=y.getHashPath(a),u=d+">div[lay-id]";if(i.pageTabs){var m;e(o+">.layui-tab-title>li").each(function(){e(this).attr("lay-id")===r&&(m=!0)}),m||(y.mTabList.length+1>=i.maxTabNum&&l.closeThisTabs(y.mTabList[0].path.join("/")),h=!0,t.tabAdd(c,{id:r,title:'<span class="title">'+(a.name||"")+"</span>",content:'<div lay-id="'+r+'" lay-url="'+a.href+'"></div>'}),r!==n.index&&y.mTabList.push(a),i.cacheTab&&l.putTempData("indexTabs",y.mTabList));var f=e(u=o+'>.layui-tab-content>.layui-tab-item>div[lay-id="'+r+'"]').attr("lay-url");if(a.href!==f){layui.event.call(this,"admin","destroy("+r+")"),e(u).attr("lay-url",a.href),m=!1;for(var b=0;b<y.mTabList.length;b++)y.mTabList[b].href===f&&(y.mTabList[b]=a);i.cacheTab&&l.putTempData("indexTabs",y.mTabList)}m&&!a.refresh||(a.refresh&&layui.event.call(this,"admin","destroy("+r+")"),y.renderView(a,u)),a.noChange||a.refresh||t.tabChange(c,r)}else l.activeNav(a.href),0===e(u).length?e(d).html(['<div class="layui-body-header">','<span class="layui-body-header-title"></span>','<span class="layui-breadcrumb pull-right" lay-filter="admin-body-breadcrumb" style="visibility: visible;"></span>',"</div>",'<div lay-id="'+r+'" lay-url="'+a.href+'"></div>'].join("")):(layui.event.call(this,"admin","destroy("+e(u).attr("lay-id")+")"),e(u).attr("lay-id",r).attr("lay-url",a.href)),e('[lay-filter="admin-body-breadcrumb"]').html(y.getBreadcrumbHtml(r)),y.mTabList.splice(0,y.mTabList.length),r===n.index?y.setTabTitle(e(a.name).text()||e(s+' [href="#/'+n.index+'"]').text()||"主页"):(y.mTabList.push(a),y.setTabTitle(a.name)),y.renderView(a,u),i.cacheTab&&l.putTempData("indexTabs",y.mTabList);l.getPageWidth()<=768&&l.flexible(!0),e(".layui-table-tips-c").trigger("click")},renderView:function(a,t,n){var r=e(t),s=a.iframe||"",d=s.indexOf("@");if(n||(n=r.parent()),""===s||"#"==s||d>-1){var o=i.viewPath||layui.cache.maps.replace(/\/*$/,"");d>-1&&(o=o.substring(0,o.lastIndexOf("/"))),l.showLoading({elem:n,size:""}),l.ajax({url:o+"/"+a.path.join("/")+i.viewSuffix,data:a.search,dataType:"html",success:function(d){if(l.removeLoading(n),"string"!=typeof d&&(d=JSON.stringify(d)),0===d.indexOf("<tpl")){var o=e("<div>"+d+"</div>"),u={};for(var c in o.find("script,[tpl-ignore]").each(function(a){var t=e(this);u["temp_"+a]=t[0].outerHTML,t.after("${temp_"+a+"}").remove()}),d=layui.laytpl(o.html()).render(a),u)d=d.replace("${"+c+"}",u[c])}0===s.indexOf("#")?l.open({type:1,area:["100%","100%"],title:a.name,content:d,cancel:function(){i.pageTabs?l.closeThisTabs(y.getHashPath(a)):location.href="#"}}):(r.html(d),setTimeout(function(){r.find(".render").map(function(){layui.form.render(e(this))})},100),r.find("input[date-render]").map(function(){let a=e.extend({type:"date",range:!0,format:"yyyy/MM/dd"},lay.options(e(this),"date-render"));this.setAttribute("autocomplete","off"),layui.laydate.render({elem:this,type:a.type,range:a.range,format:a.format,done:function(){e(this.elem).trigger("input")}})}),r.find(".layui-form [lay-submit][lay-filter^='search-']").map(function(){let a=e(this).attr("lay-filter"),t=a.split("-"),i=t[3]?t[3]:"";layui.form.on("submit("+a+")",function(a){let l=a.field;if(t[2]&&"all"==t[2]&&(l={},i)){let t=i.split("|");e.each(t,function(e,t){l[t]=a.field[t]?a.field[t]:""})}return layui.table.reloadData(t[1],{where:l,page:{curr:1}}),!1})}),l.vDict(r),l.vShow(r),l.renderTpl(t+" [v-tpl]"))}})}else 0===s.indexOf("#")?l.open({type:2,area:["100%","100%"],title:a.name,content:s.substr(1),cancel:function(){i.pageTabs?l.closeThisTabs(y.getHashPath(a)):location.href="#"}}):r.html(['<div class="admin-iframe" style="-webkit-overflow-scrolling: touch;">','<iframe src="',s,'" class="admin-iframe" frameborder="0"></iframe>',"</div>"].join(""))},loadHome:function(a){var t=l.getTempData("indexTabs");if(y.regRouter([a]),i.pageTabs){var r=n.routerInfo(a.url);if(n.index=y.getHashPath(r),y.changeView(e.extend(r,{name:a.name,iframe:a.iframe,noChange:!0})),!1!==a.loadSetting&&i.cacheTab&&t)for(var s=0;s<t.length;s++)y.changeView(e.extend(t[s],{noChange:!0}))}l.removeLoading(void 0,!1),n.init({index:a.url,notFound:l.routerNotFound})},openNewTab:function(a){y.regRouter([a]),n.go(a.url)},closeTab:function(a){t.tabDelete(c,y.getHashPath(a))},getHashPath:function(a){return a&&"string"!=typeof a||(a=n.routerInfo(a)),a.path.join("/")},go:function(a){n.go(a)},clearTabCache:function(){l.putTempData("indexTabs",null)},setTabTitle:function(a,t){i.pageTabs?(t||(t=y.getHashPath()),t&&e(o+'>.layui-tab-title>li[lay-id="'+t+'"] .title').html(a||"")):a?(e(u+">.layui-body-header-title").html(a),e(u).addClass("show"),e(r).css("box-shadow","0 1px 0 0 rgba(0, 0, 0, .03)")):(e(u).removeClass("show"),e(r).css("box-shadow",""))},setTabTitleHtml:function(a){if(!i.pageTabs){if(!a)return e(u).removeClass("show");e(u).html(a),e(u).addClass("show")}},getBreadcrumb:function(a){a||(a=e(d+">div[lay-id]").attr("lay-id"));var t=[],i=e(s).find('[href="#/'+a+'"]');for(i.length>0&&t.push(i.text().replace(/(^\s*)|(\s*$)/g,""));0!==(i=i.parent("dd").parent("dl").prev("a")).length;)t.unshift(i.text().replace(/(^\s*)|(\s*$)/g,""));return t},getBreadcrumbHtml:function(a){for(var e=y.getBreadcrumb(a),t=a===n.index?"":'<a href="#/'+n.index+'">首页</a>',i=0;i<e.length-1;i++)t&&(t+='<span lay-separator="">/</span>'),t+="<a><cite>"+e[i]+"</cite></a>";return t},toNav:function(a,e,t){let i="",l="";return a.forEach(n=>{n.pid!=e||t&&t!=n.catid||(l='<a href="'+(n.url||"javascript:;")+'" target="'+(n.target||"_self")+'"><i class="layui-icon '+n.icon+'"></i>',i+=0==e?'<li class="layui-nav-item">'+l+"&emsp;<cite>"+n.name+"</cite></a>"+y.toNav(a,n.id,t)+"</li>":"<dd>"+l+n.name+"</a>"+y.toNav(a,n.id,t)+"</dd>")}),e>0&&(i=i?'<dl class="layui-nav-child">'+i+"</dl>":""),i},buildLeftMenus:function(a,n){if(a.hasOwnProperty("cat")){var d="",o="";e(s).html(""),a.cat.forEach(t=>{d='<ul nav-id="'+t.catid+'" class="layui-nav layui-nav-tree '+(i.navArrow||"")+'" lay-filter="admin-side-nav" lay-shrink="all">'+y.toNav(a.menus,0,t.catid)+"</ul>",e(s).append(d),o+='<li class="layui-nav-item big-nav"><a nav-bind="'+t.catid+'">'+(t.icon?'<i class="layui-icon '+t.icon+' hicon"></i>':"")+t.title+"</a></li>"}),e(r+">.layui-layout-left .big-nav").remove(),e(r+">.layui-layout-left").append(o),a=a.menus}else e(s+">.layui-nav").html(y.toNav(a,0));y.regRouter(a),t.render("nav","admin-side-nav"),y.loadHome({url:n||"#/index/main",name:'<i class="layui-icon layui-icon-home"></i>'}),l.removeLoading()}},m=".layui-layout-admin .site-mobile-shade";0===e(m).length&&e(".layui-layout-admin").append('<div class="site-mobile-shade"></div>'),e(m).click(function(){l.flexible(!0)}),i.pageTabs&&0===e(o).length&&e(d).html(['<div class="layui-tab" lay-allowClose="true" lay-filter="',c,'" lay-autoRefresh="',1==i.tabAutoRefresh,'">','<ul class="layui-tab-title"></ul><div class="layui-tab-content"></div></div>','<div class="layui-icon admin-tabs-control layui-icon-prev" v-event="leftPage"></div>','<div class="layui-icon admin-tabs-control layui-icon-next" v-event="rightPage"></div>'].join("")),t.on("nav(admin-side-nav)",function(a){var t=e(a).attr("href");0===t.indexOf("#")&&"true"==e(o).attr("lay-autoRefresh")&&(h||l.refresh(t.substring(1),!0))}),t.on("tab("+c+")",function(){var a=e(this).attr("lay-id"),t=e(o+'>.layui-tab-content>.layui-tab-item>div[lay-id="'+a+'"]').attr("lay-url");l.activeNav(t),l.rollPage("auto"),"true"!=e(o).attr("lay-autoRefresh")||h?n.go(t):l.refresh(t,!0),h=!1,l.resizeTable(0),layui.event.call(this,"admin","show("+a+")"),layui.event.call(this,"admin","tab({*})",{layId:a})}),t.on("tabDelete("+c+")",function(a){if(a.index>0&&a.index<=y.mTabList.length){var t=y.getHashPath(y.mTabList[a.index-1].href);layui.event.call(this,"admin","destroy("+t+")"),y.mTabList.splice(a.index-1,1),i.cacheTab&&l.putTempData("indexTabs",y.mTabList),layui.event.call(this,"admin","tabDelete({*})",{layId:t})}0===e(o+">.layui-tab-title>li.layui-this").length&&e(o+">.layui-tab-title>li:last").trigger("click")}),e(document).off("click.navMore").on("click.navMore","[nav-bind]",function(){var a=e(this).attr("nav-bind");e('ul[lay-filter="admin-side-nav"]').addClass("layui-hide"),e('ul[nav-id="'+a+'"]').removeClass("layui-hide"),e(r+">.layui-nav .layui-nav-item").removeClass("layui-this"),e(this).parent(".layui-nav-item").addClass("layui-this"),l.getPageWidth()<=768&&l.flexible(!1),layui.event.call(this,"admin","nav({*})",{navId:a})}),i.openTabCtxMenu&&i.pageTabs&&e(o+">.layui-tab-title").off("contextmenu.tab").on("contextmenu.tab","li",function(a){var i=e(this).attr("lay-id");return layui.dropdown.render({elem:e(this),trigger:"contextmenu",style:"width:110px",show:!0,data:[{title:"刷新当前",templet:'<i class="layui-icon layui-icon-refresh"></i> {{d.title}}',id:"tab_mt1"},{title:"关闭其他",templet:'<i class="layui-icon layui-icon-unlink"></i> {{d.title}}',id:"tab_mt2"},{title:"关闭全部",templet:'<i class="layui-icon layui-icon-close"></i> {{d.title}}',id:"tab_mt3"}],click:function(a){if("tab_mt1"===a.id){t.tabChange(c,i);var n=e(o+'>.layui-tab-content>.layui-tab-item>div[lay-id="'+i+'"]').attr("lay-url");"true"!=e(o).attr("lay-autoRefresh")&&l.refresh(n)}else"tab_mt2"===a.id?l.closeOtherTabs(i):"tab_mt3"===a.id&&l.closeAllTabs()}}),!1}),a("index",y)});